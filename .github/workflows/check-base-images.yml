name: Check base images

on:
  workflow_dispatch:
    inputs:
      MINIMAL_SUPPORTED_VERSION:
        description: 'Minimal supported version from which we should start checking images, e.g. 5.1, 5.0.1, 4.2.3. Default derived from supported maintenance versions'
        required: false
      ENVIRONMENT:
        description: 'Environment to use'
        required: true
        type: choice
        options:
          - sandbox
          - live
  schedule:
    - cron: '0 6 * * *'

jobs:
  get-environment:
    runs-on: ubuntu-latest
    outputs:
      environment1: ${{ steps.determine-environment.outputs.environment1 }}
      environment2: ${{ inputs.ENVIRONMENT || 'live' }}
    steps:
      - id: determine-environment
        run: |
          echo "environment1=${{ inputs.ENVIRONMENT || 'live' }}" >> "${GITHUB_OUTPUT}"

  calculate-rebuilds:
    runs-on: ubuntu-latest
    needs:
      - get-environment
    steps:
      - name: Check if ${{ matrix.version }} base images updated
        if: steps.check-base-images.outputs.outdated == 'true'
        run: |
          echo "environment1 is ${{ needs.get-environment.outputs.environment1}}"
          echo "environment2 is ${{ needs.get-environment.outputs.environment2}}"

