name: Build PR

on:
  pull_request:

jobs:
  prepare:
    runs-on: ubuntu-latest
    name: Prepare environment
    steps:
      - name: Checkout Code
        uses: actions/checkout@v5
        with:
          fetch-depth: 0

      - name: Forbid .github/release_type file
        run: |
          if [ -f ".github/release_type" ]; then
            echo "Error: .github/release_type file is not allowed in the PRs. It's used only during release creation"
            exit 1
          fi

      - name: Test scripts
        run: |
          .github/scripts/test_scripts.sh

  test-push:
    name: Test pushing image (dry run)
    uses: ./.github/workflows/tag_image_push.yml
    with:
      SOURCE_REF: ${{ github.ref }}
      RELEASE_TYPE: ALL
      DRY_RUN: true
      # DI-635 - Should Docker PR builder push to sandbox?
      ENVIRONMENT: live
    secrets: inherit

  test-push-nlc:
    name: Test pushing image (dry run)
    uses: ./.github/workflows/ee-nlc-tag-push.yml
    with:
      SOURCE_REF: ${{ github.ref }}
      DRY_RUN: true
      # DI-635 - Should Docker PR builder push to sandbox?
      ENVIRONMENT: live
    secrets: inherit
